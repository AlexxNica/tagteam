<%= documentation('hub-wide-item-search') %>
<div style="margin-bottom: 1em;">
  <h2>Feed Item Search</h2>
  <%= form_tag(item_search_hub_path(@hub), :method => :get, :id => 'hub_search_form') do %>
    <%= text_field_tag :q, params[:q], :size => 50, :placeholder => 'Keyword search. . .' %> <br/>
    <%= text_field_tag :include_tags, params[:include_tags], :size => 50, :placeholder => 'Include these tags. . . .' %><br/>
    <%= text_field_tag :exclude_tags, params[:exclude_tags], :size => 50, :placeholder => 'Exclude these tags. . . .' %><br/>

    <%= text_field_tag :in_hub_feeds, params[:in_hub_feeds], :size => 50, :placeholder => 'In these feeds. . . .' %><br/>
    <div id="hub_feed_container">
      <% HubFeed.find(:all, :conditions => {:id => params[:hub_feed_ids]}).each do|hf| %>
        <span class="hub_feed_search_select"><input name="hub_feed_ids[]" type="hidden" value="<%= hf.id %>" /><%= hf.display_title %><span class="search_select_control"> X </span></span>
      <% end %>
    </div>
    <%= submit_tag('Search items', :class => 'button') %>
  <% end %>
</div>

<% if @search.blank? || @search.results.length == 0 %>
  <h3>Nothing. Please try a different term.</h3>
<% else %>
  <%= will_paginate @search.results %>
  <table class="hub">
    <% @search.results.each do|r| %>
      <%= render :partial => 'shared/line_items/feed_item', :object => r %>
    <% end %>
  </table>
  <%= will_paginate @search.results %>
<% end %>

<%= javascript_tag %Q|$(document).ready(function(){
$.observeTagAutocomplete(#{@hub.id},'#include_tags'); 
$.observeTagAutocomplete(#{@hub.id},'#exclude_tags');
$.observeHubFeedAutocomplete(#{@hub.id},'#in_hub_feeds');
$.observeSearchSelectControl();
});| %>
